<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Залы музея</title>
  <link rel="icon" th:href="@{/css/favicon.ico}">
  <link th:href="@{/css/style.css}" rel="stylesheet">
</head>

<header>
  <nav class="headnav">
    <div class="heading">
      <h4>Музей зелени</h4>
      <p class="sub">The first museum of greenery</p>
    </div>


    <nav class="navbar">
      <div class="leaf">
        <img src="/css/leaf.png" alt="Иконка листика">
      </div>
      <a th:href="@{/exhibits}" class="nav-link">Экспонаты</a>

      <a th:if="${currentUserAuthorities.toString().contains('ADMIN') or currentUserAuthorities.toString().contains('SUPER_ADMIN') or currentUserAuthorities.toString().contains('GUIDE')}"
         th:href="@{/halls}" class="nav-link" >Залы</a>

      <a th:href="@{/exhibitions}" class="nav-link">Выставки</a>

      <a th:href="@{/visits}" class="nav-link">Посещения</a>

      <a th:href="@{/about}" class="nav-link">Об авторе</a>

      <!-- Только для админов: управление пользователями -->
      <a th:if="${currentUserAuthorities.toString().contains('SUPER_ADMIN')}"
         th:href="@{/users}" class="nav-link">Пользователи</a>

      <a th:if="${currentUserAuthorities?.toString()?.contains('ADMIN') or currentUserAuthorities?.toString()?.contains('SUPER_ADMIN') or currentUserAuthorities?.toString()?.contains('GUIDE')}"
         th:href="@{/statistics}" class="nav-link">Статистика</a>

    </nav>


    <div style="margin-left: auto; display: flex; align-items: center; gap: 12px;">
      <span class="hello">Здравствуйте, <b th:text="${currentUserFullName}">Имя</b>!</span>
      <a th:href="@{/logout}" class="nav-link exit">Выйти</a>
    </div>

  </nav>
</header>


<body class="container">

<!--<div class="background-overlay1"></div> -->

<div class="card">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h1>Список залов</h1>

    <form th:action="@{/halls}" method="get" class="row g-2 mb-4 align-items-center">
      <div class="col-auto d-flex gap-2">
        <input type="text" name="name" class="form-control"
               placeholder="Поиск по названию зала"
               th:value="${searchName}" style="min-width: 200px;">
        <input type="number" name="floor" class="form-control"
               placeholder="Этаж"
               th:value="${searchFloor}" style="min-width: 100px;">
        <button type="submit" class="btn btn-primary">Найти</button>
        <button type="submit" class="btn btn-primary" style="color:white; text-decoration: none;" th:href="@{/halls.html}">Сбросить</a></button>
      </div>
    </form>

  </div>

  <div class="table-container" style="margin-top:20px;">
    <table>
      <thead>
      <tr>
        <th>Название</th>
        <th>Этаж</th>
        <th>Вместимость</th>
        <th>Описание</th>
        <th>Действия</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="hall : ${halls}">
        <th:block th:if="${hall.id == editingId}">
          <td colspan="5" class="edit-form">
            <form th:action="@{/halls/save}" th:object="${hall}" method="post" class="row g-2 align-items-center">
              <input type="hidden" th:field="*{id}"/>
              <div class="col-md-3 form-group">
                <input type="text" th:field="*{name}" class="form-control" placeholder="Название зала" required/>
              </div>
              <div class="col-md-1 form-group">
                <input type="number" th:field="*{floor}" class="form-control" placeholder="Этаж" required/>
              </div>
              <div class="col-md-2 form-group">
                <input type="number" th:field="*{capacity}" class="form-control" placeholder="Вместимость" required/>
              </div>
              <div class="col-md-4 form-group">
                <input type="text" th:field="*{description}" class="form-control" placeholder="Описание"/>
              </div>
              <div class="col-md-2 d-flex gap-2">
                <button type="submit" class="btn btn-primary">Сохранить</button>
                <a th:href="@{/halls}" class="btn btn-outline">Отмена</a>
              </div>
            </form>
          </td>
        </th:block>

        <th:block th:if="${hall.id != editingId}">
          <td th:text="${hall.name}">Название зала</td>
          <td th:text="${hall.floor}">Этаж</td>
          <td th:text="${hall.capacity}">Вместимость</td>
          <td th:text="${hall.description ?: '—'}">Описание</td>
          <td>
            <div th:if="${currentUserAuthorities.toString().contains('ADMIN') or currentUserAuthorities.toString().contains('SUPER_ADMIN')}">
              <a th:href="@{'/halls/edit/' + ${hall.id}}" class="btn btn-warning">Редактировать</a>
              <a th:href="@{'/halls/delete/' + ${hall.id}}" class="btn btn-danger"
                 onclick="return confirm('Удалить зал? Все экспонаты в нём потеряют привязку!')">Удалить</a>
            </div>
            <div th:if="${currentUserAuthorities.toString().contains('VISITOR') or currentUserAuthorities.toString().contains('GUIDE')}">
              <span>—</span>
            </div>
          </td>
        </th:block>
      </tr>
      </tbody>
    </table>
  </div>


  <div th:if="${currentUserAuthorities.toString().contains('ADMIN') or currentUserAuthorities.toString().contains('SUPER_ADMIN')}">
    <h2>Добавить новый зал</h2>
    <form th:action="@{/halls/add}" th:object="${hall}" method="post" class="row g-3 mt-3">
      <div class="col-md-3 form-group">
        <input type="text" class="form-control" placeholder="Название зала" th:field="*{name}" required/>
      </div>
      <div class="col-md-1 form-group">
        <input type="number" class="form-control" placeholder="Этаж" th:field="*{floor}" required/>
      </div>
      <div class="col-md-2 form-group">
        <input type="number" class="form-control" placeholder="Вместимость" th:field="*{capacity}" required/>
      </div>
      <div class="col-md-4 form-group">
        <input type="text" class="form-control" placeholder="Описание (опционально)" th:field="*{description}"/>
      </div>
      <div class="col-md-2 form-group">
        <button type="submit" class="btn btn-primary w-100">Добавить зал</button>
      </div>
    </form>
  </div>
</div>

<footer class="main-footer">
  <div class="footer-copyright">
    &copy; 2025 Музей зелени.
  </div>
</footer>

</body>
</html>