<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Выставки</title>
  <link rel="icon" th:href="@{/css/favicon.ico}">
  <link th:href="@{/css/style.css}" rel="stylesheet">
</head>

<header>
  <nav class="headnav">
    <div class="heading">
      <h4>Музей зелени</h4>
      <p class="sub">The first museum of greenery</p>
    </div>


    <nav class="navbar">
      <div class="leaf">
        <img src="/css/leaf.png" alt="Иконка листика">
      </div>
      <a th:href="@{/exhibits}" class="nav-link">Экспонаты</a>

      <a th:if="${currentUserAuthorities.toString().contains('ADMIN') or currentUserAuthorities.toString().contains('SUPER_ADMIN') or currentUserAuthorities.toString().contains('GUIDE')}"
         th:href="@{/halls}" class="nav-link" >Залы</a>

      <a th:href="@{/exhibitions}" class="nav-link">Выставки</a>

      <a th:href="@{/visits}" class="nav-link">Посещения</a>

      <a th:href="@{/about}" class="nav-link">Об авторе</a>

      <!-- Только для админов: управление пользователями -->
      <a th:if="${currentUserAuthorities.toString().contains('SUPER_ADMIN')}"
         th:href="@{/users}" class="nav-link">Пользователи</a>

      <a th:if="${currentUserAuthorities?.toString()?.contains('ADMIN') or currentUserAuthorities?.toString()?.contains('SUPER_ADMIN') or currentUserAuthorities?.toString()?.contains('GUIDE')}"
         th:href="@{/statistics}" class="nav-link">Статистика</a>

    </nav>


    <div style="margin-left: auto; display: flex; align-items: center; gap: 12px;">
      <span class="hello">Здравствуйте, <b th:text="${currentUserFullName}">Имя</b>!</span>
      <a th:href="@{/logout}" class="nav-link exit">Выйти</a>
    </div>

  </nav>
</header>



<body class="container">

<!--<div class="background-overlay1"></div> -->


<div class="card">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h1>Текущие и будущие выставки</h1>
    <a th:if="${currentUserAuthorities?.toString()?.contains('GUIDE')}"
       th:href="@{/my-exhibitions}" class="nav-link myexh">Мои выставки</a>
  </div>

  <div class="table-container">
    <table>
      <thead>
      <tr>
        <th>Название</th>
        <th>Куратор</th>
        <th>Начало</th>
        <th>Окончание</th>
        <th>Описание</th>
        <th>Действия</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="exhibition : ${exhibitions}">
        <th:block th:if="${exhibition.id == editingId}">
          <td colspan="6" class="edit-form">
            <form th:action="@{/exhibitions/save}" method="post" class="row g-2 align-items-center">
              <input type="hidden" name="id" th:value="${exhibition.id}"/>
              <div class="col-md-3 form-group">
                <input type="text" name="title" class="form-control"
                       placeholder="Название выставки"
                       th:value="${exhibition.title}" required/>
              </div>
              <div class="col-md-2 form-group">
                <label>Куратор:</label>
                <select name="curatorEmail" class="form-control" required>
                  <option value="">Выберите гида</option>
                  <option th:each="g : ${guides}"
                          th:value="${g.email}"
                          th:text="${g.fullName}"
                          th:selected="${g.email == exhibition.curator?.email}">Гид</option>
                </select>
              </div>
              <div class="col-md-2 form-group">
                <input type="date" name="startDate" class="form-control"
                       th:value="${exhibition.startDate}" required/>
              </div>
              <div class="col-md-2 form-group">
                <input type="date" name="endDate" class="form-control"
                       th:value="${exhibition.endDate}" required/>
              </div>
              <div class="col-md-3 form-group">
                <input type="text" name="description" class="form-control"
                       placeholder="Описание"
                       th:value="${exhibition.description}"/>
              </div>
              <div class="col-md-2 d-flex gap-2">
                <button type="submit" class="btn btn-primary">Сохранить</button>
                <a th:href="@{/exhibitions}" class="btn btn-outline">Отмена</a>
              </div>
              <div th:if="${param.error}" class="alert" style="color: #b00020; margin-top: 8px;">
                Неверный формат даты. Используйте ГГГГ-ММ-ДД.
              </div>
            </form>
          </td>
        </th:block>

        <th:block th:if="${exhibition.id != editingId}">
          <td th:text="${exhibition.title}">Название</td>
          <td th:text="${exhibition.curator?.fullName ?: '—'}">Куратор</td>
          <td th:text="${exhibition.startDate}">Начало</td>
          <td th:text="${exhibition.endDate}">Окончание</td>
          <td th:text="${exhibition.description ?: '—'}">Описание</td>
          <td>
            <div th:if="${currentUserAuthorities.toString().contains('ADMIN') or currentUserAuthorities.toString().contains('SUPER_ADMIN')}">
              <a th:href="@{'/exhibitions/edit/' + ${exhibition.id}}" class="btn btn-warning">Редактировать</a>
              <a th:href="@{'/exhibitions/delete/' + ${exhibition.id}}" class="btn btn-danger"
                 onclick="return confirm('Удалить выставку?')">Удалить</a>
            </div>
            <div th:if="${currentUserAuthorities.toString().contains('VISITOR') or currentUserAuthorities.toString().contains('GUIDE')}">
              <span>—</span>
            </div>
          </td>
        </th:block>
      </tr>
      </tbody>
    </table>
  </div>

  <div th:if="${currentUserAuthorities.toString().contains('ADMIN') or currentUserAuthorities.toString().contains('SUPER_ADMIN')}">
    <h2>Добавить новую выставку</h2>
    <form th:action="@{/exhibitions/add}" method="post" class="row g-3 mt-3">
      <div class="col-md-3 form-group">
        <input type="text" name="title" class="form-control" placeholder="Название выставки" required/>
      </div>
      <div class="col-md-2 form-group">
        <select name="curatorEmail" class="form-control" required>
          <option value="">Выберите гида</option>
          <option th:each="g : ${guides}"
                  th:value="${g.email}"
                  th:text="${g.fullName}">Гид</option>
        </select>
      </div>
      <div class="col-md-2 form-group">
        <input type="date" name="startDate" class="form-control" placeholder="Дата начала" required/>
      </div>
      <div class="col-md-2 form-group">
        <input type="date" name="endDate" class="form-control" placeholder="Дата окончания" required/>
      </div>
      <div class="col-md-3 form-group">
        <input type="text" name="description" class="form-control" placeholder="Описание (опционально)"/>
      </div>
      <div class="col-md-12">
        <button type="submit" class="btn btn-primary">Добавить выставку</button>
        <div th:if="${param.error}" class="alert" style="color: #b00020; margin-top: 8px;">
          Неверный формат даты. Используйте ГГГГ-ММ-ДД.
        </div>
      </div>
    </form>
  </div>

  <div class="permanent-exhibitions-section">
    <h2>Постоянные выставки</h2>
    <div class="permanent-cards">
      <div class="permanent-card hidden">
        <img src="/css/exh1.png" alt="Постоянная выставка 1">
        <p>Ботаника сквозь века: гербарные коллекции XVIII–XX веков</p>
      </div>
      <div class="permanent-card hidden">
        <img src="/css/exh2.png" alt="Постоянная выставка 2">
        <p>Тропическая оранжерея: живые растения со всего мира</p>
      </div>
      <div class="permanent-card hidden">
        <img src="/css/exh3.png" alt="Постоянная выставка 3">
        <p>Эволюция зелёных: от папоротников до цветковых</p>
      </div>
      <div class="permanent-card hidden">
        <img src="/css/exh4.png" alt="Постоянная выставка 4">
        <p>Лекарственные растения: от фитотерапии до современной фармакологии</p>
      </div>
      <div class="permanent-card hidden">
        <img src="/css/exh5.png" alt="Постоянная выставка 5">
        <p>Деревья-долгожители: история и экология вековых растений</p>
      </div>
      <div class="permanent-card hidden">
        <img src="/css/exh6.png" alt="Постоянная выставка 6">
        <p>Символика растений в культуре и искусстве</p>
      </div>
    </div>
  </div>

  <script>
    const cards = document.querySelectorAll(".permanent-card");
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if(entry.isIntersecting){
          entry.target.classList.add("show");
        }
      });
    }, { threshold: 0.1 });
    cards.forEach(card => observer.observe(card));
  </script>
</div>

<footer class="main-footer">
  <div class="footer-copyright">
    &copy; 2025 Музей зелени.
  </div>
</footer>

</body>
</html>