<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Управление пользователями</title>
  <link rel="icon" th:href="@{/css/favicon.ico}">
  <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body class="container">

<nav class="navbar">
  <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
    <a href="/exhibits" class="nav-link">Вернуться к каталогу</a>
    <a th:href="@{/logout}" class="nav-link exit">Выйти</a>
  </div>
</nav>

<div class="card">
  <h2>Управление пользователями</h2>
  <table class="table">
    <thead>
    <tr>
      <th>Email</th>
      <th>Полное имя</th>
      <th>Роль</th>
      <th>Дата регистрации</th>
      <th>Действия</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="user : ${users}">
      <td th:text="${user.email}">email</td>
      <td th:text="${user.fullName}">Полное имя</td>
      <td>
        <form th:action="@{/users/{id}/role(id=${user.id})}" method="post" style="display:flex; gap:8px; align-items:center;">
          <select name="role"
                  th:disabled="${user.role.name() == 'SUPER_ADMIN'}"
                  th:class="${user.role.name() == 'SUPER_ADMIN'} ? 'form-control disabled' : 'form-control'">
            <option value="VISITOR" th:selected="${user.role.name() == 'VISITOR'}">Посетитель</option>
            <option value="GUIDE" th:selected="${user.role.name() == 'GUIDE'}">Экскурсовод</option>
            <option value="ADMIN" th:selected="${user.role.name() == 'ADMIN'}">Админ</option>
            <option value="SUPER_ADMIN" th:selected="${user.role.name() == 'SUPER_ADMIN'}" disabled>Супер-админ</option>
          </select>
          <button type="submit"
                  th:if="${user.role.name() != 'SUPER_ADMIN'}"
                  class="btn btn-success">Сохранить</button>
          <span th:if="${user.role.name() == 'SUPER_ADMIN'}" style="color:#666;">-</span>
        </form>
      </td>
      <td th:text="${#temporals.format(user.createdAt, 'yyyy-MM-dd HH:mm')}">2025-11-25</td>
      <td>
        <form th:action="@{/users/{id}/delete(id=${user.id})}" method="post"
              onsubmit="return confirm('Вы уверены, что хотите удалить пользователя?');">
          <button type="submit"
                  th:if="${user.role.name() != 'SUPER_ADMIN'}"
                  class="btn btn-danger">Удалить</button>
          <span th:if="${user.role.name() == 'SUPER_ADMIN'}" style="color:#666;">—</span>
        </form>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<footer class="main-footer">
  <div class="footer-copyright">
    &copy; 2025 Музей зелени.
  </div>
</footer>

</body>
</html>